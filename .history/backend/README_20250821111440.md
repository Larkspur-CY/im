# IM聊天系统后端

基于SpringBoot的实时聊天系统后端服务，支持WebSocket实时通讯。

## 技术栈

- Spring Boot 2.7.14
- Spring WebSocket
- Spring Security
- Spring Data JPA
- MyBatis Plus
- MySQL 8.0
- JWT认证
- Lombok

## 项目结构

```
backend/
├── src/
│   ├── main/
│   │   ├── java/com/im/backend/
│   │   │   ├── ImBackendApplication.java          # 主启动类
│   │   │   ├── config/                            # 配置类
│   │   │   │   ├── WebSocketConfig.java           # WebSocket配置
│   │   │   │   └── SecurityConfig.java            # 安全配置
│   │   │   ├── controller/                        # 控制器
│   │   │   │   ├── UserController.java            # 用户管理
│   │   │   │   ├── MessageController.java         # 消息管理
│   │   │   │   └── ChatController.java            # WebSocket聊天
│   │   │   ├── service/                           # 业务逻辑
│   │   │   │   ├── UserService.java               # 用户服务
│   │   │   │   └── MessageService.java            # 消息服务
│   │   │   ├── repository/                        # 数据访问
│   │   │   │   ├── UserRepository.java            # 用户仓库
│   │   │   │   └── MessageRepository.java         # 消息仓库
│   │   │   └── model/                             # 实体类
│   │   │       ├── User.java                      # 用户实体
│   │   │       └── Message.java                   # 消息实体
│   │   └── resources/
│   │       ├── application.yml                    # 应用配置
│   │       └── schema.sql                         # 数据库初始化
│   └── test/
└── pom.xml                                        # Maven配置
```

## 功能特性

### 用户管理
- 用户注册/登录
- 用户信息管理
- 在线状态管理
- 密码加密存储

### 消息功能
- 实时消息发送/接收
- 消息历史记录
- 未读消息统计
- 消息已读状态
- 支持文本、图片、文件等消息类型

### WebSocket通讯
- 实时双向通讯
- 用户上线/离线通知
- 消息推送
- 支持私聊和群聊

## 快速开始

### 环境要求
- JDK 8+
- Maven 3.6+
- MySQL 8.0+

### 数据库配置
1. 创建MySQL数据库：
```sql
CREATE DATABASE im_chat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. 修改`application.yml`中的数据库连接配置：
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/im_chat?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=GMT%2B8
    username: root
    password: your_password
```

### 运行项目
```bash
# 编译项目
mvn clean compile

# 运行项目
mvn spring-boot:run
```

### 测试接口

#### 用户注册
```bash
curl -X POST http://localhost:8080/api/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456",
    "email": "test@example.com",
    "nickname": "测试用户"
  }'
```

#### 用户登录
```bash
curl -X POST http://localhost:8080/api/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "password": "123456"
  }'
```

#### WebSocket连接
前端可以通过以下地址连接WebSocket：
```
ws://localhost:8080/ws
```

## API文档

### 用户接口
- `GET /api/users` - 获取所有用户
- `GET /api/users/{id}` - 获取指定用户
- `POST /api/users/register` - 用户注册
- `POST /api/users/login` - 用户登录
- `PUT /api/users/{id}` - 更新用户信息
- `DELETE /api/users/{id}` - 删除用户
- `GET /api/users/online` - 获取在线用户

### 消息接口
- `POST /api/messages` - 发送消息
- `GET /api/messages/between/{senderId}/{receiverId}` - 获取两用户间消息
- `GET /api/messages/unread/{userId}` - 获取未读消息
- `GET /api/messages/unread/count/{userId}` - 获取未读消息数量
- `PUT /api/messages/read/{messageId}` - 标记消息已读
- `PUT /api/messages/read/{senderId}/{receiverId}` - 标记所有消息已读
- `GET /api/messages/history/{userId}` - 获取消息历史
- `DELETE /api/messages/{messageId}` - 删除消息

### WebSocket消息格式
```json
{
  "senderId": 1,
  "receiverId": 2,
  "content": "Hello World",
  "type": "TEXT"
}
```

## 开发说明

### 默认测试账号
- 用户名: admin, 密码: admin
- 用户名: user1, 密码: user1  
- 用户名: user2, 密码: user2

### 注意事项
1. 首次运行会自动创建数据表
2. 密码使用BCrypt加密存储
3. WebSocket支持跨域访问
4. 开发环境已禁用CSRF保护
